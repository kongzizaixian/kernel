/*
 * Copyright (C) huawei
 * The program is used to dump message
 */


#include "higgs_common.h"
#include "higgs_dump.h"
#include "higgs_pv660.h"
#include "higgs_io.h"
#include "higgs_dev.h"

static s32 higgs_format_req_to_buffer(char *buffer,
				      s32 buffer_size,
				      struct higgs_req *req, bool dump_detail);
static s32 higgs_format_cmd_table_to_buffer(char *buffer,
					    s32 buffer_size,
					    struct higgs_cmd_table *cmd_table,
					    bool dump_detail);
static s32 higgs_format_dq_info_to_buffer(char *buffer,
					  s32 buffer_size,
					  struct higgs_dq_info *dq_info);
static s32 higgs_format_devid_addr_to_buffer(char *buffer,
					     s32 buffer_size,
					     struct higgs_req *req);

#define  CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset) \
	do {\
		if (offset < 0)\
			return total_offset;\
		total_offset += offset;\
		if (!(total_offset < BUFFER_SIZE))\
			return total_offset;\
	} while(0)

#define HIGGS_PRINT_ELEMENTS_PER_LINE   16


/*SAS global cfg register, the address is nonsequence*/
u32 glb_cfg_reg_addr_array[HIGGS_SAS_GLB_REG_NUM] = {
	HISAS30HV100_GLOBAL_REG_INT_COAL_EN_REG,	/* 0x1BC*/
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_0_REG,	/* 0x260 Delivery Queue low 32bit */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_1_REG,	/* 0x274  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_2_REG,	/* 0x288  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_3_REG,	/* 0x29C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_4_REG,	/* 0x2B0  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_5_REG,	/* 0x2C4  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_6_REG,	/* 0x2D8  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_7_REG,	/* 0x2EC  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_8_REG,	/* 0x300  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_9_REG,	/* 0x314  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_10_REG,	/* 0x328  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_11_REG,	/* 0x33C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_12_REG,	/* 0x350  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_13_REG,	/* 0x364  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_14_REG,	/* 0x378  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_15_REG,	/* 0x38C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_16_REG,	/* 0x3A0  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_17_REG,	/* 0x3B4  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_18_REG,	/* 0x3C8  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_19_REG,	/* 0x3DC  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_20_REG,	/* 0x3F0  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_21_REG,	/* 0x404  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_22_REG,	/* 0x418  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_23_REG,	/* 0x42C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_24_REG,	/* 0x440  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_25_REG,	/* 0x454  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_26_REG,	/* 0x468  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_27_REG,	/* 0x47C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_28_REG,	/* 0x490  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_29_REG,	/* 0x4A4  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_30_REG,	/* 0x4B8  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRL_31_REG,	/* 0x4CC  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_0_REG,	/* 0x264  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_1_REG,	/* 0x278  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_2_REG,	/* 0x28C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_3_REG,	/* 0x2A0  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_4_REG,	/* 0x2B4  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_5_REG,	/* 0x2C8  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_6_REG,	/* 0x2DC  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_7_REG,	/* 0x2F0  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_8_REG,	/* 0x304  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_9_REG,	/* 0x318  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_10_REG,	/* 0x32C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_11_REG,	/* 0x340  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_12_REG,	/* 0x354  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_13_REG,	/* 0x368  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_14_REG,	/* 0x37C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_15_REG,	/* 0x390  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_16_REG,	/* 0x3A4  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_17_REG,	/* 0x3B8  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_18_REG,	/* 0x3CC  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_19_REG,	/* 0x3E0  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_20_REG,	/* 0x3F4  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_21_REG,	/* 0x408  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_22_REG,	/* 0x41C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_23_REG,	/* 0x430  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_24_REG,	/* 0x444  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_25_REG,	/* 0x458  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_26_REG,	/* 0x46C  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_27_REG,	/* 0x480  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_28_REG,	/* 0x494  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_29_REG,	/* 0x4A8  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_30_REG,	/* 0x4BC  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_BASE_ADDRU_31_REG,	/* 0x4D0  */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_0_REG,	/*0x268 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_1_REG,	/*0x27C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_2_REG,	/*0x290 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_3_REG,	/*0x2A4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_4_REG,	/*0x2B8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_5_REG,	/*0x2CC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_6_REG,	/*0x2E0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_7_REG,	/*0x2F4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_8_REG,	/*0x308 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_9_REG,	/*0x31C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_10_REG,	/*0x330 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_11_REG,	/*0x344 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_12_REG,	/*0x358 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_13_REG,	/*0x36C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_14_REG,	/*0x380 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_15_REG,	/*0x394 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_16_REG,	/*0x3A8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_17_REG,	/*0x3BC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_18_REG,	/*0x3D0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_19_REG,	/*0x3E4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_20_REG,	/*0x3F8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_21_REG,	/*0x40C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_22_REG,	/*0x420 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_23_REG,	/*0x434 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_24_REG,	/*0x448 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_25_REG,	/*0x45C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_26_REG,	/*0x470 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_27_REG,	/*0x484 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_28_REG,	/*0x498 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_29_REG,	/*0x4AC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_30_REG,	/*0x4C0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_DEPTH_31_REG,	/*0x4D4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_0_REG,	/*0x26C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_1_REG,	/*0x280 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_2_REG,	/*0x294 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_3_REG,	/*0x2A8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_4_REG,	/*0x2BC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_5_REG,	/*0x2D0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_6_REG,	/*0x2E4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_7_REG,	/*0x2F8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_8_REG,	/*0x30C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_9_REG,	/*0x320 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_10_REG,	/*0x334 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_11_REG,	/*0x348 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_12_REG,	/*0x35C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_13_REG,	/*0x370 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_14_REG,	/*0x384 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_15_REG,	/*0x398 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_16_REG,	/*0x3AC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_17_REG,	/*0x3C0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_18_REG,	/*0x3D4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_19_REG,	/*0x3E8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_20_REG,	/*0x3FC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_21_REG,	/*0x410 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_22_REG,	/*0x424 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_23_REG,	/*0x438 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_24_REG,	/*0x44C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_25_REG,	/*0x460 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_26_REG,	/*0x474 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_27_REG,	/*0x488 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_28_REG,	/*0x49C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_29_REG,	/*0x4B0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_30_REG,	/*0x4C4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_WRT_PTR_31_REG,	/*0x4D8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_0_REG,	/*0x270 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_1_REG,	/*0x284 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_2_REG,	/*0x298 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_3_REG,	/*0x2AC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_4_REG,	/*0x2C0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_5_REG,	/*0x2D4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_6_REG,	/*0x2E8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_7_REG,	/*0x2FC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_8_REG,	/*0x310 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_9_REG,	/*0x324 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_10_REG,	/*0x338 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_11_REG,	/*0x34C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_12_REG,	/*0x360 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_13_REG,	/*0x374 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_14_REG,	/*0x388 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_15_REG,	/*0x39C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_16_REG,	/*0x3B0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_17_REG,	/*0x3C4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_18_REG,	/*0x3D8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_19_REG,	/*0x3EC */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_20_REG,	/*0x400 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_21_REG,	/*0x414 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_22_REG,	/*0x428 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_23_REG,	/*0x43C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_24_REG,	/*0x450 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_25_REG,	/*0x464 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_26_REG,	/*0x478 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_27_REG,	/*0x48C */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_28_REG,	/*0x4A0 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_29_REG,	/*0x4B4 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_30_REG,	/*0x4C8 */
	HISAS30HV100_GLOBAL_REG_DLVRY_QUEUE_RD_PTR_31_REG,	/*0x4DC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_0_REG,	/*0x4E0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_1_REG,	/*0x4F4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_2_REG,	/*0x508 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_3_REG,	/*0x51C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_4_REG,	/*0x530 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_5_REG,	/*0x544 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_6_REG,	/*0x558 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_7_REG,	/*0x56C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_8_REG,	/*0x580 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_9_REG,	/*0x594 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_10_REG,	/*0x5A8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_11_REG,	/*0x5BC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_12_REG,	/*0x5D0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_13_REG,	/*0x5E4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_14_REG,	/*0x5F8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_15_REG,	/*0x60C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_16_REG,	/*0x620 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_17_REG,	/*0x634 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_18_REG,	/*0x648 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_19_REG,	/*0x65C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_20_REG,	/*0x670 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_21_REG,	/*0x684 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_22_REG,	/*0x698 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_23_REG,	/*0x6AC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_24_REG,	/*0x6C0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_25_REG,	/*0x6D4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_26_REG,	/*0x6E8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_27_REG,	/*0x6FC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_28_REG,	/*0x710 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_29_REG,	/*0x724 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_30_REG,	/*0x738 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRL_31_REG,	/*0x74C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_0_REG,	/*0x4E4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_1_REG,	/*0x4F8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_2_REG,	/*0x50C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_3_REG,	/*0x520 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_4_REG,	/*0x534 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_5_REG,	/*0x548 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_6_REG,	/*0x55C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_7_REG,	/*0x570 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_8_REG,	/*0x584 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_9_REG,	/*0x598 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_10_REG,	/*0x5AC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_11_REG,	/*0x5C0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_12_REG,	/*0x5D4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_13_REG,	/*0x5E8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_14_REG,	/*0x5FC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_15_REG,	/*0x610 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_16_REG,	/*0x624 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_17_REG,	/*0x638 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_18_REG,	/*0x64C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_19_REG,	/*0x660 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_20_REG,	/*0x674 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_21_REG,	/*0x688 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_22_REG,	/*0x69C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_23_REG,	/*0x6B0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_24_REG,	/*0x6C4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_25_REG,	/*0x6D8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_26_REG,	/*0x6EC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_27_REG,	/*0x700 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_28_REG,	/*0x714 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_29_REG,	/*0x728 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_30_REG,	/*0x73C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_BASE_ADDRU_31_REG,	/*0x750 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_0_REG,	/*0x4E8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_1_REG,	/*0x4FC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_2_REG,	/*0x510 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_3_REG,	/*0x524 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_4_REG,	/*0x538 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_5_REG,	/*0x54C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_6_REG,	/*0x560 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_7_REG,	/*0x574 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_8_REG,	/*0x588 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_9_REG,	/*0x59C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_10_REG,	/*0x5B0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_11_REG,	/*0x5C4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_12_REG,	/*0x5D8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_13_REG,	/*0x5EC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_14_REG,	/*0x600 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_15_REG,	/*0x614 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_16_REG,	/*0x628 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_17_REG,	/*0x63C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_18_REG,	/*0x650 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_19_REG,	/*0x664 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_20_REG,	/*0x678 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_21_REG,	/*0x68C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_22_REG,	/*0x6A0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_23_REG,	/*0x6B4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_24_REG,	/*0x6C8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_25_REG,	/*0x6DC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_26_REG,	/*0x6F0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_27_REG,	/*0x704 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_28_REG,	/*0x718 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_29_REG,	/*0x72C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_30_REG,	/*0x740 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_DEPTH_31_REG,	/*0x754 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_0_REG,	/*0x4EC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_1_REG,	/*0x500 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_2_REG,	/*0x514 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_3_REG,	/*0x528 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_4_REG,	/*0x53C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_5_REG,	/*0x550 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_6_REG,	/*0x564 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_7_REG,	/*0x578 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_8_REG,	/*0x58C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_9_REG,	/*0x5A0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_10_REG,	/*0x5B4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_11_REG,	/*0x5C8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_12_REG,	/*0x5DC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_13_REG,	/*0x5F0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_14_REG,	/*0x604 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_15_REG,	/*0x618 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_16_REG,	/*0x62C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_17_REG,	/*0x640 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_18_REG,	/*0x654 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_19_REG,	/*0x668 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_20_REG,	/*0x67C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_21_REG,	/*0x690 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_22_REG,	/*0x6A4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_23_REG,	/*0x6B8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_24_REG,	/*0x6CC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_25_REG,	/*0x6E0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_26_REG,	/*0x6F4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_27_REG,	/*0x708 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_28_REG,	/*0x71C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_29_REG,	/*0x730 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_30_REG,	/*0x744 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_WRT_PTR_31_REG,	/*0x758 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_0_REG,	/*0x4F0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_1_REG,	/*0x504 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_2_REG,	/*0x518 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_3_REG,	/*0x52C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_4_REG,	/*0x540 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_5_REG,	/*0x554 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_6_REG,	/*0x568 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_7_REG,	/*0x57C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_8_REG,	/*0x590 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_9_REG,	/*0x5A4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_10_REG,	/*0x5B8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_11_REG,	/*0x5CC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_12_REG,	/*0x5E0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_13_REG,	/*0x5F4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_14_REG,	/*0x608 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_15_REG,	/*0x61C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_16_REG,	/*0x630 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_17_REG,	/*0x644 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_18_REG,	/*0x658 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_19_REG,	/*0x66C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_20_REG,	/*0x680 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_21_REG,	/*0x694 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_22_REG,	/*0x6A8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_23_REG,	/*0x6BC */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_24_REG,	/*0x6D0 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_25_REG,	/*0x6E4 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_26_REG,	/*0x6F8 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_27_REG,	/*0x70C */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_28_REG,	/*0x720 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_29_REG,	/*0x734 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_30_REG,	/*0x748 */
	HISAS30HV100_GLOBAL_REG_CMPLTN_QUEUE_RD_PTR_31_REG,	/*0x75C */
	HISAS30HV100_GLOBAL_REG_HGC_ECO_REG0_REG,	        /*0x7D0 */
	HISAS30HV100_GLOBAL_REG_HGC_ECO_REG1_REG,	        /*0x7D4 */
	HISAS30HV100_GLOBAL_REG_HGC_ECO_REG2_REG	        /*0x7D8 */
};

/*SAS port cfg register, the address is nonsequence*/
u32 port_cfg_reg_addr_array[HIGGS_SAS_PORT_REG_NUM] = {
	HISAS30HV100_PORT_REG_RXOP_CHECK_CFG_H_REG,	/*0xFC  */
	HISAS30HV100_PORT_REG_RX_SMP_ERR_INFO_REG,	/*0x194 */
	HISAS30HV100_PORT_REG_TRANS_MACHINE_STATUS_REG,	/*0x19C */
	HISAS30HV100_PORT_REG_PHY_CONFIG0_REG,	/*0x1A0 */
	HISAS30HV100_PORT_REG_PHY_CONFIG1_REG,	/*0x1A4 */
	HISAS30HV100_PORT_REG_PHY_CONFIG2_REG,	/*0x1A8 */
	HISAS30HV100_PORT_REG_CHL_INT0_REG,	/*0x1B0 */
	HISAS30HV100_PORT_REG_CHL_INT1_REG,	/*0x1B4 */
	HISAS30HV100_PORT_REG_CHL_INT2_REG,	/*0x1B8 */
	HISAS30HV100_PORT_REG_CHL_INT0_MSK_REG,	/*0x1BC */
	HISAS30HV100_PORT_REG_CHL_INT1_MSK_REG,	/*0x1C0 */
	HISAS30HV100_PORT_REG_CHL_INT2_MSK_REG,	/*0x1C4 */
	HISAS30HV100_PORT_REG_CHL_INT_COAL_EN_REG,	/*0x1D0 */
	HISAS30HV100_PORT_REG_CHL_RST_REG,	        /*0x1D4 */
	HISAS30HV100_PORT_REG_ERR_STAT_EN_L_REG,	/*0x1E0 */
	HISAS30HV100_PORT_REG_ERR_STAT_EN_H_REG,	/*0x1E4 */
	HISAS30HV100_PORT_REG_ERR_CNT0_REG,	/*0x1E8  */
	HISAS30HV100_PORT_REG_ERR_CNT1_REG,	/*0x1EC  */
	HISAS30HV100_PORT_REG_ERR_CNT2_REG,	/*0x1F0  */
	HISAS30HV100_PORT_REG_ERR_CNT3_REG,	/*0x1F4  */
	HISAS30HV100_PORT_REG_TXFH_DWORD4_REG,	/*0x240  */
	HISAS30HV100_PORT_REG_TXFH_DWORD5_REG,	/*0x244  */
	HISAS30HV100_PORT_REG_TX_FRM_MAX_SIZE_REG,	/*0x248  */
	HISAS30HV100_PORT_REG_TX_SMP_FRM_REQ_REG,	/*0x250  */
	HISAS30HV100_PORT_REG_TX_SSP_FRM_REQ_REG,	/*0x25C  */
	HISAS30HV100_PORT_REG_TRANS_TXRX_STATUS_REG,	/*0x264  */
	HISAS30HV100_PORT_REG_IO_END_STATUS_REG,	/*0x268  */
	HISAS30HV100_PORT_REG_HGC_IO_TX_CONFIG_R_REG,	/*0x270  */
	HISAS30HV100_PORT_REG_HGC_IO_CMD_CONFIG_R_REG,	/*0x274  */
	HISAS30HV100_PORT_REG_HGC_IO_CMD_BASEADDR_L_REG,	/*0x278  */
	HISAS30HV100_PORT_REG_HGC_IO_CMD_BASEADDR_H_REG,	/*0x27C  */
	HISAS30HV100_PORT_REG_HGC_IO_CMD_DATA_LENGTH_REG,	/*0x280  */
	HISAS30HV100_PORT_REG_HGC_IO_DATA_PRDT_ADDR_L_REG,	/*0x284  */
	HISAS30HV100_PORT_REG_HGC_IO_DATA_PRDT_ADDR_H_REG,	/*0x288  */
	HISAS30HV100_PORT_REG_HGC_IO_SGL_LENGTH_REG,	        /*0x28C  */
	HISAS30HV100_PORT_REG_HGC_IO_DIF_PRDT_ADDR_L_REG,	/*0x290  */
	HISAS30HV100_PORT_REG_HGC_IO_DIF_PRDT_ADDR_H_REG,	/*0x294  */
	HISAS30HV100_PORT_REG_DMA_TX_DFX0_REG,	/*0x29C  */
	HISAS30HV100_PORT_REG_DMA_TX_DFX1_REG,	/*0x2A0  */
	HISAS30HV100_PORT_REG_DMA_TX_DFX2_REG,	/*0x2A4  */
	HISAS30HV100_PORT_REG_DMA_RX_DFX0_REG,	/*0x2A8  */
	HISAS30HV100_PORT_REG_DMA_RX_DFX1_REG,	/*0x2AC  */
	HISAS30HV100_PORT_REG_DMA_RX_DFX2_REG,	/*0x2B0  */
	HISAS30HV100_PORT_REG_DMA_TX_ERR_STATUS_REG,	/*0x2C4  */
	HISAS30HV100_PORT_REG_DMA_TX_STATUS_REG,	/*0x2D0  */
	HISAS30HV100_PORT_REG_DMA_RX_ERR_STATUS_REG,	/*0x2DC  */
	HISAS30HV100_PORT_REG_HGC_DMA_TX_FAIL_PROC_CFG_REG,	/*0x2E0  */
	HISAS30HV100_PORT_REG_DMA_RX_STATUS_REG,	        /*0x2E8  */
	HISAS30HV100_PORT_REG_DMA_TX_XFER_LGTH_REG,	        /*0x2F4  */
	HISAS30HV100_PORT_REG_DMA_TX_XFER_OFFSET_REG,	        /*0x2F8  */
	HISAS30HV100_PORT_REG_HGC_IO_FST_BURST_NUM_REG,	        /*0x2FC  */
	HISAS30HV100_PORT_REG_HGC_IO_RESP_CONFIG_R_REG,	        /*0x300  */
	HISAS30HV100_PORT_REG_HGC_IO_STATUS_BUF_ADDR_L_REG,	/*0x304  */
	HISAS30HV100_PORT_REG_HGC_IO_STATUS_BUF_ADDR_H_REG,	/*0x308  */
	HISAS30HV100_PORT_REG_RX_OPAF_DWORD0_REG,	/*0x30C  */
	HISAS30HV100_PORT_REG_RX_OPAF_DWORD1_REG,	/*0x310  */
	HISAS30HV100_PORT_REG_RX_OPAF_DWORD2_REG,	/*0x314  */
	HISAS30HV100_PORT_REG_RX_OPAF_DWORD3_REG,	/*0x318  */
	HISAS30HV100_PORT_REG_RX_OPAF_DWORD4_REG,	/*0x31C  */
	HISAS30HV100_PORT_REG_RX_OPAF_DWORD5_REG,	/*0x320  */
	HISAS30HV100_PORT_REG_RX_OPAF_DWORD6_REG,	/*0x324  */
	HISAS30HV100_PORT_REG_G_CSR_CFGR_HOST_REG	/*0x39C  */
};

void higgs_hex_dump(char *hdr, u8 * buf, u32 len, u32 width)
{
	u32 i;
	u32 rec = 0;

	if (NULL == buf) {
		printk("buffer is null\n");
		return;
	}

	printk("%s , addr %p\n", hdr, buf);
	for (i = 0; i < len;) {
		if (4 <= (len - i)) {
			if (width == 4) {
				printk("%04X(dw%2d) 0x%08X \n",
				       i, (i / 4), *((u32 *) (u64) (&buf[i])));
			} else {
				printk("%04x(dw%2d) 0x%02X, 0x%02X, 0x%02X, 0x%02X \n", 
                    i, (i / 4), buf[i], buf[(u32) (i + 1)], 
                    buf[(u32) (i + 2)], buf[(u32) (i + 3)]);    /*lint*/
			}
			i += 4;
			continue;
		}

		if (0x00 == rec) {
			printk("%04x(dw%2d)", i, (1 + i / 4));
			rec++;
		}

		printk(" 0x%02x ", buf[i]);
		i++;
	}

	printk("\n");

	return;
}

void higgs_create_dump_file_name(char *str, u32 size, u8 card_no,
				 char *filename)
{
	u32 dump_index = sal_global.fw_dump_idx[card_no];
	(void)snprintf(str, size, "%sCard%02d-%d-%s",
		       HIGGS_DUMP_DIR_PATH, card_no, dump_index, filename);

	return;
}

struct file *higgs_open_file(const char *filename, mm_segment_t *oldfs)
{
	struct file *fp = NULL;

	if (NULL == filename) {
		HIGGS_TRACE(OSP_DBL_MAJOR, 4098,
			    "higgs_open_file is error,the filename is NULL");
		return NULL;
	}

	fp = filp_open(filename, (s32) (O_WRONLY | O_CREAT), 0777);
	if (IS_ERR(fp)) {
		HIGGS_TRACE(OSP_DBL_MAJOR, 4099, "Create file %s failed",
			    filename);
		return NULL;
	}

	*oldfs = SAS_GET_FS();
	SAS_SET_FS(KERNEL_DS);

	return fp;
}

s32 higgs_close_file(struct file * fp, mm_segment_t mm_oldfs)
{
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MAJOR, 4102, "fp is NULL");
		return ERROR;
	}

	SAS_SET_FS(mm_oldfs);
	(void)filp_close(fp, NULL);

	return OK;
}

s32 higgs_write_file(struct file * fp, const void *buf, const u32 count)
{
	s32 ret = ERROR;

	if (NULL == fp || NULL == fp->f_op || NULL == fp->f_op->write) {
		HIGGS_TRACE(OSP_DBL_MAJOR, 4100,
			    "fp is NULL or v_pstFp->f_op is NULL or v_pstFp->f_op->write is NULL!");
		return ERROR;
	}
	/*lint -e10*/
	ret = fp->f_op->write(fp, buf, count, &fp->f_pos);
	/*lint +e10*/
	if (ret < 0) {
		HIGGS_TRACE(OSP_DBL_MAJOR, 4101, "higgs_write_file error");
		return ERROR;
	}

	return OK;

}

u32 higgs_read_glb_cfg_reg(struct sal_card * sal_card, u32 reg_addr)
{
	u32 data = 0;
	struct higgs_card *higgs_card = NULL;

	higgs_card = (struct higgs_card *)sal_card->drv_data;

	data = (u32) HIGGS_GLOBAL_REG_READ(higgs_card, reg_addr);

#ifdef HIGGS_CPU_BIG_ENDIAN
	data = HIGGS_SWAP_32(data);
#endif

	return data;
}

u32 higgs_read_port_cfg_reg(struct sal_card * sal_card,
			    u32 phy_id, u32 reg_addr)
{
	u32 data = 0;
	struct higgs_card *higgs_card = NULL;

	higgs_card = (struct higgs_card *)sal_card->drv_data;

	data = (u32) HIGGS_PORT_REG_READ(higgs_card, phy_id, reg_addr);

#ifdef HIGGS_CPU_BIG_ENDIAN
	data = HIGGS_SWAP_32(data);
#endif

	return data;
}

void higgs_write_port_cfg_reg(struct sal_card *sal_card,
			      u32 phy_id, u32 reg_addr, u32 reg_val)
{
	struct higgs_card *higgs_card = NULL;

	higgs_card = (struct higgs_card *)sal_card->drv_data;

	HIGGS_PORT_REG_WRITE(higgs_card, phy_id, reg_addr, reg_val);

	return;
}

s32 higgs_flush_cipi_to_file(struct higgs_card * higgs_card,
			     u32 max_qnum,
			     enum higgs_queue_type q_type, struct file * fp)
{
	u32 buf_tmp_a = 0;
	u32 buf_tmp_b = 0;
	u32 buf_tmp_c = 0;
	u32 i = 0;
	s32 ret = ERROR;
	char string[HIGGS_ARRAY_SIZE];

	for (i = 0; i < max_qnum; i++) {
		memset(string, 0, sizeof(string));
		if (HIGGS_IS_DQ_TYPE == q_type) {
			/*Dump DQ write  pointer*/
			buf_tmp_a =
			    higgs_card->io_hw_struct_info.delivery_queue[i].
			    wpointer;

			/*Dump DQ write  pointer*/
			buf_tmp_b = (u32) HIGGS_DQ_WPT_GET(higgs_card, i);

			/*Dump DQ read  pointer*/
			buf_tmp_c = (u32) HIGGS_DQ_RPT_GET(higgs_card, i);

			(void)snprintf(string, HIGGS_ARRAY_SIZE - 1,
				       " DQ%d : MemoryDqWrPointer=0x%08X, RegDqWrPointer=0x%08X, RegDqRdPointer=0x%08X; \n",
				       i, buf_tmp_a, buf_tmp_b, buf_tmp_c);
		} else if (HIGGS_IS_CQ_TYPE == q_type) {
			/*Dump CQ read  pointer*/
			buf_tmp_a =
			    higgs_card->io_hw_struct_info.complete_queue[i].
			    rpointer;

			/*Dump CQ write  pointer*/
			buf_tmp_b = (u32) HIGGS_CQ_WPT_GET(higgs_card, i);

			/*Dump CQ read  pointer*/
			buf_tmp_c = (u32) HIGGS_CQ_RPT_GET(higgs_card, i);

			(void)snprintf(string, HIGGS_ARRAY_SIZE - 1,
				       " CQ%d : MemoryCqRdPointer=0x%08X, RegCqWrPointer=0x%08X, RegCqRdPointer=0x%08X; \n",
				       i, buf_tmp_a, buf_tmp_b, buf_tmp_c);
		} else {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Error Reg type FOUND when dump CI PI. ");
			return ERROR;
		}

		/*Flush CI/PI into file */
		ret = higgs_write_file(fp, string, SAS_STRLEN(string));
		if (ERROR == ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write File Failed when write CI PI ! ");
			return ERROR;
		}

	}

	return OK;
}

s32 higgs_cipi_dqcq_index_dump(struct sal_card * sal_card)
{

	u32 max_dq_num = 0;
	u32 max_cq_num = 0;
	struct higgs_card *higgs_card = NULL;
	struct file *fp = NULL;
	s32 ret = ERROR;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	mm_segment_t mm_oldfs;

	HIGGS_ASSERT(NULL != sal_card, return ERROR);
	higgs_card = (struct higgs_card *)sal_card->drv_data;

	max_dq_num = higgs_card->higgs_can_dq;
	max_cq_num = higgs_card->higgs_can_cq;

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no, HIGGS_PI_CI_INDEX_FILE);

	fp = higgs_open_file(file_str, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4152, "Open File:%s Failed.",
			    file_str);
		goto FAIL;
	}

	ret = higgs_flush_cipi_to_file(higgs_card,
				       max_dq_num, HIGGS_IS_DQ_TYPE, fp);
	if (ERROR == ret)
		goto FAIL;
    
	ret = higgs_flush_cipi_to_file(higgs_card,
				       max_cq_num, HIGGS_IS_CQ_TYPE, fp);
	if (ERROR == ret)
		goto FAIL;

	HIGGS_TRACE(OSP_DBL_MINOR, 4152,
		    "Dump CI PI Index and save File:%s OK.", file_str);

	return OK;

      FAIL:
	if (fp)
		(void)higgs_close_file(fp, mm_oldfs);

	return ret;

}

s32 higgs_get_single_qlog_dump(u32 oq_num, char *pfile_name,
			       void *qhead_addr, u32 num_ele, u32 qele_size)
{
	struct file *fp = NULL;
	char file_name[HIGGS_MAX_DUMP_FILE_NAME_LEN + 50] = { 0 };
	char buffer_write[HIGGS_ARRAY_SIZE] = { 0 };
	u32 ele_no = 0;
	u32 i = 0;
	s32 ret = ERROR;
	u32 *mem_addr = NULL;
	mm_segment_t mm_oldfs = { 0 };

	HIGGS_ASSERT(NULL != pfile_name, return ERROR);
	HIGGS_ASSERT(NULL != qhead_addr, return ERROR);
	if (0 == num_ele) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4187,
			    "Warning: The size of Queue is ZERO, Queue No. %d !",
			    oq_num);
		return ret;
	}

	(void)snprintf(file_name, sizeof(file_name), "%s-%02d.txt", pfile_name,
		       oq_num);

	fp = higgs_open_file(file_name, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4187,
			    "Open Queue log File %s Failed.", file_name);
		goto FAIL;
	}

	(void)snprintf(buffer_write,
		       sizeof(buffer_write),
		       "Queue: Index = %d, BaseAddr = 0x%p, EntryNum = %d, EntrySize = %d\n",
		       oq_num, qhead_addr, num_ele, qele_size);

	ret = higgs_write_file(fp, buffer_write, SAS_STRLEN(buffer_write));
	if (OK != ret) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4188,
			    "Write Queue log File %s Failed.", file_name);
		goto FAIL;
	}

	for (ele_no = 0; ele_no < num_ele; ele_no++) {
		(void)snprintf(buffer_write, sizeof(buffer_write),
			       "[0x%03x] : {[", ele_no);

		ret =
		    higgs_write_file(fp, buffer_write,
				     SAS_STRLEN(buffer_write));
		if (OK != ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4188,
				    "Write Queue log File %s Failed.",
				    file_name);
			goto FAIL;
		}

		mem_addr =
		    (u32 *) (u64) ((u8 *) qhead_addr +
				   (u64) ele_no * qele_size);

		for (i = 0; i < qele_size; i += sizeof(u32)) {
			(void)snprintf(buffer_write, sizeof(buffer_write),
				       "0X%08X,", *mem_addr);

			ret =
			    higgs_write_file(fp, buffer_write,
					     SAS_STRLEN(buffer_write));
			if (OK != ret) {
				HIGGS_TRACE(OSP_DBL_MINOR, 4189,
					    "Write Q log File:%s Failed.",
					    file_name);
				goto FAIL;
			}
			mem_addr++;
		}

		(void)snprintf(buffer_write, sizeof(buffer_write), "]}\n");

		ret =
		    higgs_write_file(fp, buffer_write,
				     SAS_STRLEN(buffer_write));
		if (OK != ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4190,
				    "Write Q log File:%s Failed.", file_name);
			goto FAIL;
		}

	}

	HIGGS_TRACE(OSP_DBL_MINOR, 4190, "Write Q log File:%s OK.", file_name);

	ret = OK;

      FAIL:
	if (fp)
		(void)higgs_close_file(fp, mm_oldfs);

	return ret;

}

s32 higgs_get_dq_log_dump(struct sal_card * sal_card)
{
	u32 max_iq = 0;
	u32 iq_num = 0;
	u32 queue_entry_size = 0;
	s32 ret = ERROR;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	struct higgs_card *higgs_card = NULL;
	/* struct higgs_dqueue* start_vir_addr = NULL; */
	struct higgs_dq_info *queue_base_addr = NULL;
	u32 queue_depth = 0;

	HIGGS_ASSERT(NULL != sal_card, return ERROR);

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no, HIGGS_DQ_LOG_FILE);

	higgs_card = (struct higgs_card *)sal_card->drv_data;
	HIGGS_ASSERT(NULL != higgs_card, return ERROR);

	max_iq = higgs_card->higgs_can_dq;
	queue_entry_size = (u32) sizeof(struct higgs_dq_info);

	for (iq_num = 0; iq_num < max_iq; iq_num++) {
		queue_base_addr =
		    higgs_card->io_hw_struct_info.delivery_queue[iq_num].
		    queue_base;
		queue_depth =
		    higgs_card->io_hw_struct_info.delivery_queue[iq_num].
		    dq_depth;
		ret =
		    higgs_get_single_qlog_dump(iq_num, file_str,
					       (void *)queue_base_addr,
					       queue_depth, queue_entry_size);
		if (OK != ret)
			HIGGS_TRACE(OSP_DBL_MINOR, 4192,
				    "Dump DQ:%d Failed. Maybe this DQ is empty !!",
				    iq_num);

	}

	return OK;

}

s32 higgs_get_cq_log_dump(struct sal_card * sal_card)
{
	u32 max_oq = 0;
	u32 oq_num = 0;
	u32 queue_entry_size = 0;
	s32 ret = ERROR;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	struct higgs_card *higgs_card = NULL;
	/* struct higgs_cqueue* start_vir_addr = NULL; */
	struct higgs_cq_info *queue_base_addr = NULL;
	u32 queue_depth = 0;

	HIGGS_ASSERT(NULL != sal_card, return ERROR);

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no, HIGGS_CQ_LOG_FILE);

	higgs_card = (struct higgs_card *)sal_card->drv_data;
	HIGGS_ASSERT(NULL != higgs_card, return ERROR);

	max_oq =
	    MIN((u32) HIGGS_MAX_CQ_NUM,
		higgs_card->card_cfg.numoutboundqueues);
	queue_entry_size = (u32) sizeof(struct higgs_cq_info);

	for (oq_num = 0; oq_num < max_oq; oq_num++) {
		queue_base_addr =
		    higgs_card->io_hw_struct_info.complete_queue[oq_num].
		    queue_base;
		queue_depth =
		    higgs_card->io_hw_struct_info.complete_queue[oq_num].
		    cq_depth;
		ret =
		    higgs_get_single_qlog_dump(oq_num, file_str,
					       (void *)queue_base_addr,
					       queue_depth, queue_entry_size);
		if (OK != ret)
			HIGGS_TRACE(OSP_DBL_MINOR, 4191,
				    "Dump CQ:%d Failed. Maybe this CQ is empty !!",
				    oq_num);
	}

	return OK;

}

s32 higgs_get_itct_dump(struct sal_card * sal_card)
{
	s32 ret = ERROR;
	u32 i = 0;
	struct higgs_card *higgs_card = NULL;
	struct file *fp = NULL;
	struct higgs_itct_info *start_vir_addr = NULL;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	mm_segment_t mm_oldfs = { 0 };

	HIGGS_ASSERT(sal_card != NULL, return ERROR);
	higgs_card = (struct higgs_card *)sal_card->drv_data;

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no, HIGGS_ITCT_TB_FILE);

	fp = higgs_open_file(file_str, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Open File:%s Failed.",
			    file_str);
		goto FAIL;
	}

	start_vir_addr = higgs_card->io_hw_struct_info.itct_base;
	if (NULL == start_vir_addr) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4137, "ITCT table Vir Addr NULL.");
		goto FAIL;
	}

	for (i = 0; i < higgs_card->higgs_can_dev; i++) {
		ret =
		    higgs_write_file(fp,
				     (void *)
				     &(((struct higgs_itct_info *)
					start_vir_addr)[i]),
				     sizeof(struct higgs_itct_info));
		if (ERROR == ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write File:%s Failed.", file_str);
			goto FAIL;
		}
	}

	(void)higgs_close_file(fp, mm_oldfs);
	HIGGS_TRACE(OSP_DBL_INFO, 4139, "Save file %s OK.", file_str);

	return OK;

      FAIL:
	if (fp) {
		(void)higgs_close_file(fp, mm_oldfs);
	}

	return ERROR;

}

s32 higgs_get_lost_cache_dump(struct sal_card * sal_card)
{
	u32 reg_value = 0;
	u32 iptt = 0;
	u32 iost_val_flg = 0;
	u32 io_status = 0;
	u32 reg_add_offset = 0;
	u32 i = 0;
	s32 ret = ERROR;
	char string[HIGGS_ARRAY_SIZE];
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	struct file *fp = NULL;
	mm_segment_t mm_oldfs = { 0 };

	HIGGS_ASSERT(sal_card != NULL, return ERROR);

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no,
				    HIGGS_IOST_TB_IN_CACHE_FILE);

	fp = higgs_open_file(file_str, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Open File:%s Failed.",
			    file_str);
		return ERROR;
	}

	reg_add_offset = 0x014C;
	for (i = 0; i < (HIGGS_MAX_IOST_CACHE_NUM + 1); i++) {
		reg_value = higgs_read_glb_cfg_reg(sal_card, reg_add_offset);
		iptt = (reg_value & 0x1fff);	/*bit[12:0]*/
		iost_val_flg = ((reg_value & 0x8000) >> 15);	/*bit[15] */
		io_status = ((reg_value & 0xff0000) >> 16);	/*bit[23:16]*/

		memset(string, 0, sizeof(string));
		(void)snprintf(string, HIGGS_ARRAY_SIZE - 1,
			       " iptt=%02d : IostValidFlag=%1d, IoStatus=0x%08X, IostCacheReg=0x%08X; \n",
			       iptt, iost_val_flg, io_status, reg_value);

		/*Flush them into file */
		ret = higgs_write_file(fp, string, SAS_STRLEN(string));
		if (ERROR == ret) {
			(void)higgs_close_file(fp, mm_oldfs);
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write File:%s Failed.", file_str);
			return ERROR;
		}

	}

	(void)higgs_close_file(fp, mm_oldfs);
	HIGGS_TRACE(OSP_DBL_INFO, 4139, "Save file %s OK.", file_str);

	return OK;

}

s32 higgs_get_iost_dump(struct sal_card * sal_card)
{
	s32 ret = ERROR;
	u32 i = 0;
	struct higgs_card *higgs_card = NULL;
	struct file *fp = NULL;
	struct higgs_iost_info *start_vir_addr = NULL;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	mm_segment_t mm_oldfs = { 0 };

	HIGGS_ASSERT(sal_card != NULL, return ERROR);
	higgs_card = (struct higgs_card *)sal_card->drv_data;

	ret = higgs_get_lost_cache_dump(sal_card);

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no,
				    HIGGS_IOST_TB_IN_DDR_FILE);
	fp = higgs_open_file(file_str, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Open File:%s Failed.",
			    file_str);
		goto FAIL;
	}

	start_vir_addr = higgs_card->io_hw_struct_info.iost_base;
	if (NULL == start_vir_addr) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4137, "IOST table Vir Addr NULL.");
		goto FAIL;
	}

	for (i = 0; i < higgs_card->higgs_can_io; i++) {
		ret =
		    higgs_write_file(fp,
				     (void *)
				     &(((struct higgs_iost_info *)
					start_vir_addr)[i]),
				     sizeof(struct higgs_iost_info));
		if (ERROR == ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write File:%s Failed.", file_str);
			goto FAIL;
		}
	}

	(void)higgs_close_file(fp, mm_oldfs);
	HIGGS_TRACE(OSP_DBL_INFO, 4139, "Save file %s OK. ", file_str);
	ret = OK;

	return ret;

      FAIL:
	if (fp)
		(void)higgs_close_file(fp, mm_oldfs);

	return ERROR;
}

s32 higgs_get_req_cmd_tbl_sge_dump(struct sal_card * sal_sard, bool dump_detail)
{
	char file_path[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	struct file *file = NULL;
	mm_segment_t mm_oldfs = { 0 };
	struct higgs_card *ll_card = NULL;
	struct higgs_req *req = NULL;
	struct higgs_req_manager *req_manager = NULL;
	const s32 buf_size = HIGGS_DUMP_BUFFER_SIZE;
	char *buf = NULL;
	u32 i = 0;
	unsigned long flag = 0;
	unsigned long time_start = 0;
	unsigned long time_end = 0;
	u32 max_req_num = 0;
	s32 str_len = 0;
	bool need_flush = false;
	bool active_req_num = 0;

	HIGGS_ASSERT(NULL != sal_sard, return ERROR);

	ll_card = (struct higgs_card *)sal_sard->drv_data;

	time_start = jiffies;

	higgs_create_dump_file_name(file_path, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    (u8) ll_card->card_id,
				    HIGGS_REQ_CMDTBL_SGE_FILE);
	file = higgs_open_file(file_path, &mm_oldfs);
	if (NULL == file) {
		HIGGS_TRACE(OSP_DBL_MAJOR, 151, "Card:%d Open file:%s failed",
			    ll_card->card_id, file_path);
		goto FAIL;
	}

	buf = (char *)HIGGS_VMALLOC(buf_size);
	if (NULL == buf) {
		HIGGS_TRACE(OSP_DBL_MAJOR, 151,
			    "Card:%d Allocate virtual memory failed",
			    ll_card->card_id);
		goto FAIL;
	}
	memset(buf, 0, buf_size);

	req_manager = &ll_card->higgs_req_manager;
	req = (struct higgs_req *)req_manager->req_mem;
	max_req_num = MIN(HIGGS_MAX_REQ_NUM, ll_card->higgs_can_io);
	active_req_num = 0;
	for (i = 0; i < max_req_num; i++) {
		spin_lock_irqsave(&req_manager->req_lock, flag);

		if (req->valid_and_in_use) {
			memset(buf, 0, buf_size);
			str_len =
			    higgs_format_req_to_buffer(buf, buf_size, req,
						       dump_detail);
			HIGGS_TRACE(OSP_DBL_DATA, 151,
				    "Card:%d Format REQ %p %d %d(IPTT) to buffer, %d bytes",
				    ll_card->card_id, req, i, req->iptt,
				    str_len);
			buf[buf_size - 1] = '\0';
			need_flush = true;
			active_req_num++;
		} else {
			need_flush = false;
		}

		spin_unlock_irqrestore(&req_manager->req_lock, flag);

		if (need_flush) {
			if (OK != higgs_write_file(file, buf, SAS_STRLEN(buf))) {
				HIGGS_TRACE(OSP_DBL_MAJOR, 151,
					    "Card:%d Flush buffer to file failed",
					    ll_card->card_id);
				goto FAIL;
			}
		}

		req++;
	}

	if (0 == active_req_num) {
		(void)snprintf(buf, (size_t) buf_size, "No active request\n");
		HIGGS_TRACE(OSP_DBL_MINOR, 151, "Card:%d No active request",
			    ll_card->card_id);
		if (OK != higgs_write_file(file, buf, SAS_STRLEN(buf))) {
			HIGGS_TRACE(OSP_DBL_MAJOR, 151,
				    "Card:%d Flush buffer to file failed",
				    ll_card->card_id);
			goto FAIL;
		}
	}

	HIGGS_VFREE(buf);
	buf = NULL;

	(void)higgs_close_file(file, mm_oldfs);
	file = NULL;

	time_end = jiffies;
	HIGGS_TRACE(OSP_DBL_INFO, 187,
		    "Card:%d REQ dump to %s, time cost %u ms", ll_card->card_id,
		    file_path, jiffies_to_msecs(time_end - time_start));

	return OK;

      FAIL:
	if (NULL != buf) {
		HIGGS_VFREE(buf);
		buf = NULL;
	}

	if (NULL != file) {
		(void)higgs_close_file(file, mm_oldfs);
		file = NULL;
	}

	return ERROR;
}

s32 higgs_get_io_break_tb_dump(struct sal_card * sal_card)
{
	s32 ret = ERROR;
	struct higgs_card *higgs_card = NULL;
	struct file *fp = NULL;
	struct higgs_break_point_info *start_vir_addr = NULL;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	mm_segment_t mm_oldfs = { 0 };

	HIGGS_ASSERT(sal_card != NULL, return ERROR);
	higgs_card = (struct higgs_card *)sal_card->drv_data;

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no, HIGGS_IO_BRK_TB_FILE);

	fp = higgs_open_file(file_str, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Open File:%s Failed.",
			    file_str);
		goto FAIL;
	}

	start_vir_addr = higgs_card->io_hw_struct_info.break_point;
	if (NULL == start_vir_addr) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4137, "ITCT table Vir Addr NULL.");
		goto FAIL;
	}

	ret =
	    higgs_write_file(fp, (void *)start_vir_addr,
			     higgs_card->io_hw_struct_info.break_point_size);
	if (ERROR == ret) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4138, "Write File:%s Failed.",
			    file_str);
		goto FAIL;
	}

	(void)higgs_close_file(fp, mm_oldfs);
	HIGGS_TRACE(OSP_DBL_INFO, 4139, "Save file %s OK.", file_str);

	return OK;

      FAIL:
	if (fp)
		(void)higgs_close_file(fp, mm_oldfs);

	return ERROR;
}

s32 higgs_get_sas_glb_cfg_reg_ind_dump(struct sal_card * sal_card,
				       struct file * fp)
{
	s32 ret = ERROR;
	s32 i = 0;
	u32 reg_addr_base = 0;
	u32 reg_value = 0;
	char string[HIGGS_ARRAY_SIZE];

	HIGGS_ASSERT(fp != NULL, return ERROR);

	for (i = 0; i < HIGGS_SAS_GLB_REG_NUM; i++) {
		memset(string, 0, sizeof(string));

		reg_addr_base = glb_cfg_reg_addr_array[i];
		reg_value = higgs_read_glb_cfg_reg(sal_card, reg_addr_base);

		(void)snprintf(string, HIGGS_ARRAY_SIZE - 1,
			       " RegAddrOffset=0x%08X, reg_value=0x%08X; \n",
			       reg_addr_base, reg_value);

		ret = higgs_write_file(fp, string, SAS_STRLEN(string));
		if (ERROR == ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write global cfg reg File Failed when dump RegAddr: %d. ",
				    reg_addr_base);
			return ERROR;
		}
	}

	return OK;

}

s32 higgs_cfg_reg_grp_dump(struct sal_card * sal_card,
			   u32 phy_id,
			   u32 reg_addr_base,
			   u32 reg_num,
			   enum higgs_reg_type reg_type, struct file * fp)
{
	u32 i = 0;
	u32 reg_value = 0;
	char string[HIGGS_ARRAY_SIZE];
	s32 ret = ERROR;
	mm_segment_t mm_oldfs = { 0 };
	char *file_name = NULL;

	for (i = 0; i < reg_num; i++) {
		if (HIGGS_GLB_REG_TYPE == reg_type) {
			reg_value =
			    higgs_read_glb_cfg_reg(sal_card,
						   reg_addr_base +
						   i * sizeof(u32));
			file_name = HIGGS_SAS_GLB_CFG_FILE;
		} else if (HIGGS_PORT_REG_TYPE == reg_type) {
			reg_value =
			    higgs_read_port_cfg_reg(sal_card, phy_id,
						    reg_addr_base +
						    i * sizeof(u32));
			file_name = HIGGS_SAS_PORT_CFG_FILE;
		} else {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Error Reg type FOUND when dump Reg. ");
			goto FAIL;
		}

		memset(string, 0, sizeof(string));

		(void)snprintf(string, HIGGS_ARRAY_SIZE - 1,
			       " RegAddrOffset=0x%08X, reg_value=0x%08X; \n",
			       (u32) (reg_addr_base + i * sizeof(u32)),
			       reg_value);

		ret = higgs_write_file(fp, string, SAS_STRLEN(string));
		if (ERROR == ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write File:%s Failed when dump RegAddr: 0x%08x ",
				    file_name,
				    (u32) (reg_addr_base + i * sizeof(u32)));
			goto FAIL;
		}
	}

	return OK;

      FAIL:
	if (fp)
		(void)higgs_close_file(fp, mm_oldfs);

	return ret;

}

s32 higgs_get_sas_global_cfg_reg_dump(struct sal_card * sal_card)
{
	s32 ret = ERROR;
	struct file *fp = NULL;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	mm_segment_t mm_oldfs = { 0 };

	HIGGS_ASSERT(sal_card != NULL, return ERROR);

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no, HIGGS_SAS_GLB_CFG_FILE);

	fp = higgs_open_file(file_str, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Open File:%s Failed.",
			    file_str);
		goto FAIL;
	}

	/*Dump sequential address register:0x00~0xD8 */
	ret = higgs_cfg_reg_grp_dump(sal_card, 0,
				     HISAS30HV100_GLOBAL_REG_BASE,
				     0xD8 / sizeof(u32) + 1,
				     HIGGS_GLB_REG_TYPE, fp);
	if (ERROR == ret)
		return ret;

	/*Dump sequential address register:0x100~0x154 */
	ret = higgs_cfg_reg_grp_dump(sal_card, 0,
				     HISAS30HV100_GLOBAL_REG_BASE + 0x100,
				     (0x154 - 0x100) / sizeof(u32) + 1,
				     HIGGS_GLB_REG_TYPE, fp);
	if (ERROR == ret)
		return ret;

	/*Dump sequential address register:0x1C0~0x1FC */
	ret = higgs_cfg_reg_grp_dump(sal_card, 0,
				     HISAS30HV100_GLOBAL_REG_BASE + 0x1C0,
				     (0x1FC - 0x1C0) / sizeof(u32) + 1,
				     HIGGS_GLB_REG_TYPE, fp);
	if (ERROR == ret)
		return ret;

	/*Dump sequential address register:0x238~0x240 */
	ret = higgs_cfg_reg_grp_dump(sal_card, 0,
				     HISAS30HV100_GLOBAL_REG_BASE + 0x238,
				     (0x240 - 0x238) / sizeof(u32) + 1,
				     HIGGS_GLB_REG_TYPE, fp);
	if (ERROR == ret)
		return ret;

	/*Dump nonsequential address register*/
	ret = higgs_get_sas_glb_cfg_reg_ind_dump(sal_card, fp);
	if (ERROR == ret) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4138,
			    "Write File:%s Failed when dump Other type register ",
			    file_str);
		goto FAIL;
	}

	ret = OK;

	(void)higgs_close_file(fp, mm_oldfs);
	HIGGS_TRACE(OSP_DBL_INFO, 4139,
		    "Global Reg all Save file %s OK. ", file_str);

	return ret;

      FAIL:
	if (fp)
		(void)higgs_close_file(fp, mm_oldfs);

	return ret;
}

s32 higgs_get_sas_port_cfg_reg_ind_dump(struct sal_card * sal_card,
					u32 phy_id, struct file * fp)
{
	s32 ret = ERROR;
	s32 i = 0;
	u32 reg_addr_base = 0;
	u32 reg_value = 0;
	char string[HIGGS_ARRAY_SIZE];

	HIGGS_ASSERT(fp != NULL, return ERROR);

	for (i = 0; i < HIGGS_SAS_PORT_REG_NUM; i++) {
		memset(string, 0, sizeof(string));

		reg_addr_base = port_cfg_reg_addr_array[i];
		reg_value =
		    higgs_read_port_cfg_reg(sal_card, phy_id, reg_addr_base);

		(void)snprintf(string, HIGGS_ARRAY_SIZE - 1,
			       " RegAddrOffset=0x%08X, reg_value=0x%08X; \n",
			       reg_addr_base, reg_value);

		ret = higgs_write_file(fp, string, SAS_STRLEN(string));
		if (ERROR == ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write File fail when dump port cfg reg ");
			return ERROR;
		}
	}

	return OK;

}

s32 higgs_get_sas_port_cfg_reg_dump(struct sal_card * sal_card)
{
	u32 phy_id = 0;
	s32 ret = ERROR;
	struct file *fp = NULL;
	char file_str[HIGGS_MAX_DUMP_FILE_NAME_LEN] = { 0 };
	mm_segment_t mm_oldfs = { 0 };

	HIGGS_ASSERT(NULL != sal_card, return ERROR);

	higgs_create_dump_file_name(file_str, HIGGS_MAX_DUMP_FILE_NAME_LEN,
				    sal_card->card_no, HIGGS_SAS_PORT_CFG_FILE);

	fp = higgs_open_file(file_str, &mm_oldfs);
	if (NULL == fp) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Open File:%s Failed.",
			    file_str);
		goto FAIL;
	}

	/*dump  PHY sas port cfg register */
	for (phy_id = 0; phy_id < sal_card->phy_num; phy_id++) {
		/*Dump sequential address register:0x00~0xDC */
		ret = higgs_cfg_reg_grp_dump(sal_card, phy_id,
					     HISAS30HV100_PORT_REG_BASE,
					     0xDC / sizeof(u32) + 1,
					     HIGGS_PORT_REG_TYPE, fp);
		if (ERROR == ret)
			return ret;

		/*Dump sequential address register:0x100~0x18C */
		ret = higgs_cfg_reg_grp_dump(sal_card, phy_id,
					     HISAS30HV100_PORT_REG_BASE + 0x100,
					     (0x18C - 0x100) / sizeof(u32) + 1,
					     HIGGS_PORT_REG_TYPE, fp);
		if (ERROR == ret)
			return ret;

		/*Dump sequential address register:0x200~0x23C */
		ret = higgs_cfg_reg_grp_dump(sal_card, phy_id,
					     HISAS30HV100_PORT_REG_BASE + 0x200,
					     (0x23C - 0x200) / sizeof(u32) + 1,
					     HIGGS_PORT_REG_TYPE, fp);
		if (ERROR == ret)
			return ret;

		/*Dump sequential address register:0x3A0~0x3FC */
		ret = higgs_cfg_reg_grp_dump(sal_card, phy_id,
					     HISAS30HV100_PORT_REG_BASE + 0x3A0,
					     (0x3FC - 0x3A0) / sizeof(u32) + 1,
					     HIGGS_PORT_REG_TYPE, fp);
		if (ERROR == ret)
			return ret;

		/*Dump nonsequential address register*/
		ret = higgs_get_sas_port_cfg_reg_ind_dump(sal_card, phy_id, fp);
		if (ERROR == ret) {
			HIGGS_TRACE(OSP_DBL_MINOR, 4138,
				    "Write File:%s Failed when dump Other type Port cfg reg ",
				    file_str);
			goto FAIL;
		}
	}			/*end of loop*/

	ret = OK;

	(void)higgs_close_file(fp, mm_oldfs);
	HIGGS_TRACE(OSP_DBL_INFO, 4139, "Port cfg Reg all Save file %s OK. ",
		    file_str);

	return ret;

      FAIL:
	if (fp)
		(void)higgs_close_file(fp, mm_oldfs);

	return ret;
}

s32 higgs_dump_info(struct sal_card * sal_card, void *in)
{
	u32 flag = 0;

	HIGGS_ASSERT(NULL != sal_card, return ERROR);
	HIGGS_ASSERT(NULL != in, return ERROR);

	flag = *((u32 *) in);
	HIGGS_REF(flag);

	/*dump register config message*/
	if (OK != higgs_get_sas_global_cfg_reg_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136,
			    "Dump SAS Global cfg Reg fail !!");
		return ERROR;
	}

	if (OK != higgs_get_sas_port_cfg_reg_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136,
			    "Dump SAS Port cfg Reg fail !!");
		return ERROR;
	}

	/*dump ITCT */
	if (OK != higgs_get_itct_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Dump ITCT Table fail !!");
		return ERROR;
	}

	/*dump IOST*/
	if (OK != higgs_get_iost_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Dump IOST Table fail !!");
		return ERROR;
	}

	/*dump IO Breakpoint*/
	if (OK != higgs_get_io_break_tb_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136,
			    "Dump IO BREAKPOINT Table fail !!");
		return ERROR;
	}

	/*dump DQ/CQ CI PI*/
	if (OK != higgs_cipi_dqcq_index_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Dump CI/PI fail !!");
		return ERROR;
	}

	/*dump DQ*/
	if (OK != higgs_get_dq_log_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Dump DQ fail !!");
		return ERROR;
	}

	/*dump CQ*/
	if (OK != higgs_get_cq_log_dump(sal_card)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Dump CQ fail !!");
		return ERROR;
	}

	/*dump REQ,Command Table,SGE*/
	if (OK !=
	    higgs_get_req_cmd_tbl_sge_dump(sal_card,
					   (SAL_ERROR_INFO_ALL ==
					    flag) ? true : false)) {
		HIGGS_TRACE(OSP_DBL_MINOR, 4136, "Dump REQ fail !!");
		return ERROR;
	}

	return OK;
}

static s32 higgs_format_req_to_buffer(char *pbuffer,
				      s32 buffer_size,
				      struct higgs_req *req, bool dump_detail)
{
	const s32 BUFFER_SIZE = buffer_size;
	char *buffer = pbuffer;
	s32 offset = 0;
	s32 total_offset = 0;

	HIGGS_ASSERT(NULL != pbuffer, return ERROR);
	HIGGS_ASSERT(NULL != req, return ERROR);

	/* iptt */
	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset), "REQ: %u(iptt)\n",
		     req->iptt);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	/* Base Addr */
	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "Base_addr(vir) = 0x%016llx\n", (u64) req);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	/* Queue ID */
	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset), "Queue ID = %u\n",
		     req->queue_id);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	/* Command Table */
	offset =
	    higgs_format_cmd_table_to_buffer(buffer + total_offset,
					     BUFFER_SIZE - total_offset,
					     req->cmd_table, dump_detail);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	/* DQ INFO */
	offset =
	    higgs_format_dq_info_to_buffer(buffer + total_offset,
					   BUFFER_SIZE - total_offset,
					   req->dq_info);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	/* Device ID, SAS address */
	offset =
	    higgs_format_devid_addr_to_buffer(buffer + total_offset,
					      BUFFER_SIZE - total_offset, req);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);


	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset), "\n\n");
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	return total_offset;
}

static s32 higgs_format_cmd_table_to_buffer(char *pbuffer,
					    s32 buffer_size,
					    struct higgs_cmd_table *pcmd_table,
					    bool dump_detail)
{
	struct higgs_cmd_table *cmd_table = pcmd_table;
	struct sas_ssp_open_frame *open_frame = NULL;
	const s32 BUFFER_SIZE = buffer_size;
	char *buffer = pbuffer;
	u8 *tmp_buffer = NULL;
	s32 total_offset = 0;
	s32 offset = 0;
	u32 i = 0;
	u32 size = 0;

	if (NULL == cmd_table) {
		offset =
		    snprintf(buffer + total_offset,
			     (size_t) (BUFFER_SIZE - total_offset),
			     "Command Table: NULL\n");
		CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);
		return total_offset;
	}

	open_frame = &cmd_table->open_addr_frame;
	size = (u32) sizeof(cmd_table->open_addr_frame);

	/*
	 * Status Buffer
	 *
	 */
	tmp_buffer = (u8 *) & cmd_table->status_buff;
	size = (u32) sizeof(cmd_table->status_buff);
	if (!dump_detail) {
		offset =
		    snprintf(buffer + total_offset,
			     (size_t) (BUFFER_SIZE - total_offset),
			     "Status Buffer: base_addr(vir) = 0x%016llx, size = 0x%x\n",
			     (u64) tmp_buffer, size);
		CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);
	} else {
		offset =
		    snprintf(buffer + total_offset,
			     (size_t) (BUFFER_SIZE - total_offset),
			     "Status Buffer: \n");
		CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);
		for (i = 0; i < size; i++) {
			if (0 == i % HIGGS_PRINT_ELEMENTS_PER_LINE) {
				offset =
				    snprintf(buffer + total_offset,
					     (size_t) (BUFFER_SIZE -
						       total_offset),
					     "    0x%08x: %02x ", i,
					     tmp_buffer[i]);
				CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE,
							   total_offset,
							   offset);
			} else if (0 != (i + 1) % HIGGS_PRINT_ELEMENTS_PER_LINE) {
				offset =
				    snprintf(buffer + total_offset,
					     (size_t) (BUFFER_SIZE -
						       total_offset), "%02x ",
					     tmp_buffer[i]);
				CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE,
							   total_offset,
							   offset);
			} else {
				offset =
				    snprintf(buffer + total_offset,
					     (size_t) (BUFFER_SIZE -
						       total_offset), "%02x\n",
					     tmp_buffer[i]);
				CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE,
							   total_offset,
							   offset);
			}
		}
		offset =
		    snprintf(buffer + total_offset,
			     (size_t) (BUFFER_SIZE - total_offset), "\n");
		CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);
	}

	/*
	 * SSP/SMP/STP Command Table
	 */
	tmp_buffer = (u8 *) & cmd_table->table;
	size = (u32) sizeof(cmd_table->table);
	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "SSP/SMP/STP Command Table: base_addr(vir) = 0x%016llx, size = 0x%x\n",
		     (u64) tmp_buffer, size);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	return total_offset;
}

static s32 higgs_format_dq_info_to_buffer(char *pbuffer,
					  s32 buffer_size,
					  struct higgs_dq_info *dq_info)
{
	struct higgs_dq_info *dq_info_t = dq_info;
	const s32 BUFFER_SIZE = buffer_size;
	char *buffer = pbuffer;
	s32 total_offset = 0;
	s32 offset = 0;

	if (NULL == dq_info_t) {
		offset =
		    snprintf(buffer + total_offset,
			     (size_t) (BUFFER_SIZE - total_offset),
			     "DQ Info: NULL\n");
		CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);
		return total_offset;
	}

	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "DQ Info: (maybe incorrect, for reference only)\n");
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "    dw0: 0x%08x\n" "    dw1: 0x%08x\n" "    dw2: 0x%08x\n"\
		     "    dw3: 0x%08x\n" "    data Transfer Length: 0x%08x\n"\
		     "    First Burst Number: 0x%08x\n" "    dw6: 0x%08x\n"\
		     "    dw7: 0X%08x\n", dq_info_t->dw0.chf_dw0,
		     dq_info_t->dw1.chf_dw1, dq_info_t->dw2.chf_dw2,
		     dq_info_t->dw3.chf_dw3, dq_info_t->data_trans_length,
		     dq_info_t->first_burst_num, dq_info_t->dw6.chf_dw6,
		     dq_info_t->dw7.chf_dw7);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "    Command Table Base Address: 0x%08x_%08x\n"\
		     "    Status Buffer Base Address: 0x%08x_%08x\n"\
		     "    data SGL/SGE  Base Address: 0x%08x_%08x\n"\
		     "    DIF SGL/SGE   Base Address: 0x%08x_%08x\n",
		     dq_info_t->command_table_address_upper,
		     dq_info_t->command_table_address_lower,
		     dq_info_t->status_buffer_address_upper,
		     dq_info_t->status_buffer_address_lower,
		     dq_info_t->prd_table_address_upper,
		     dq_info_t->prd_table_address_lower,
		     dq_info_t->dif_prd_table_address_upper,
		     dq_info_t->dif_prd_table_address_lower);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	return total_offset;
}

static s32 higgs_format_devid_addr_to_buffer(char *pbuffer,
					     s32 buffer_size,
					     struct higgs_req *req)
{
	struct higgs_card *ll_card = NULL;
	struct higgs_dq_info *dq_info_t = NULL;
	const s32 BUFFER_SIZE = buffer_size;
	char *buffer = pbuffer;
	s32 total_offset = 0;
	s32 offset = 0;
	u32 devid = 0;
	u64 sas_addr = 0;

	dq_info_t = req->dq_info;
	ll_card = req->higgs_card;

	if ((NULL == dq_info_t) || (NULL == ll_card)) {
		offset =
		    snprintf(buffer + total_offset,
			     (size_t) (BUFFER_SIZE - total_offset),
			     "Device ID & SAS ADDR: NULL\n");
		CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);
		return total_offset;
	}

	devid = dq_info_t->dw1.st.device_id;
	sas_addr = higgs_get_dev_sas_addr_by_dev_id(ll_card, devid);

	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "Device ID & SAS ADDR: \n");
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "    ID = 0x%04x \n", devid);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	offset =
	    snprintf(buffer + total_offset,
		     (size_t) (BUFFER_SIZE - total_offset),
		     "    SAS ADDR = 0x%016llx\n", sas_addr);
	CHECK_BUFFER_OFFSET_UPDATE(BUFFER_SIZE, total_offset, offset);

	return total_offset;
}
